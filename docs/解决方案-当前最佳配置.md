# 解决方案 - 当前最佳配置

## 🎉 好消息

**自动登录功能已修复！** 现在可以直接通过 AnyConnect VPN 获取 Cookie，不再需要 Reqable！

## ⚠️ 需要注意

**预订请求仍需 Reqable。** 由于 booking.cuhk.edu.cn 的 SSL 握手问题，Python requests 库无法直接连接，仍需通过 Reqable 代理。

---

## 推荐配置

### 配置文件（config.yaml）

```yaml
proxies: '127.0.0.1:9000'  # 使用 Reqable 代理
```

### 使用步骤

```
1. 打开 AnyConnect → 连接到学校 VPN
2. 打开 Reqable → 确保端口 9000 运行
3. 运行程序：python GUI.py
4. 点击"自动登录获取Cookie" → ✅ 成功（通过 VPN 直接连接）
5. 点击"开始"预订 → ✅ 成功（通过 Reqable 代理）
```

---

## 优势对比

### 修复前
- ❌ 自动登录：通过 Reqable 代理（慢）
- ❌ 预订请求：通过 Reqable 代理

### 修复后
- ✅ 自动登录：直接通过 VPN（快）
- ⚠️ 预订请求：仍需 Reqable 代理

**改进：** 自动登录速度更快，不受 Reqable 代理影响！

---

## 为什么还需要 Reqable？

**技术原因：**
- `booking.cuhk.edu.cn` 的 SSL 配置特殊
- Python requests 库无法直接握手
- 即使禁用 SSL 验证也无法连接
- 但 QWebEngineView（浏览器）可以连接

**详细说明：** 请查看 `重要说明-booking接口SSL问题.md`

---

## 快速测试

### 测试自动登录（不需要 Reqable）

```bash
# 1. 关闭 Reqable
# 2. 打开 AnyConnect 并连接
# 3. 启动程序
python GUI.py

# 4. 点击"Cookie" → "自动登录获取"
# 5. 观察：应该能成功获取 Cookie ✅
```

### 测试预订（需要 Reqable）

```bash
# 1. 打开 Reqable（端口 9000）
# 2. 确保 config.yaml 中 proxies: '127.0.0.1:9000'
# 3. 启动程序
python GUI.py

# 4. 点击"开始"
# 5. 观察：应该能成功预订 ✅
```

---

## 常见问题

### Q: 可以不用 Reqable 吗？

**A:** 目前不行。预订接口（booking.cuhk.edu.cn）无法通过 Python requests 直接连接。

### Q: 为什么自动登录不需要 Reqable？

**A:** 自动登录使用 QWebEngineView（浏览器内核），它的 SSL 支持更强大。

### Q: 在校园网内需要 Reqable 吗？

**A:** 可能不需要。在校园网内可以尝试设置 `proxies: ''`，但不保证成功。

---

## 文件已更新

1. ✅ `GUI.py` - 修复 QWebEngineView 代理设置
2. ✅ `main.py` - 增强错误处理
3. ✅ `config.yaml` - 恢复 Reqable 代理配置
4. ✅ 创建测试脚本和文档

---

## 总结

### ✅ 已修复
- 自动登录窗口可以直接通过 VPN 连接
- 不再显示 chrome-error 错误
- Cookie 获取速度更快

### ⚠️ 仍需 Reqable
- 预订请求因 SSL 问题仍需代理
- 这是服务器端配置导致的限制

### 📝 推荐做法
- 使用 AnyConnect + Reqable 组合
- 享受更快的自动登录体验
- 稳定的预订功能

---

**版本：** v2.8.2 - 部分修复
**日期：** 2025-10-24
**状态：** 自动登录已优化，预订仍需代理
